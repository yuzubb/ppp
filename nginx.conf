worker_processes auto;

events {
    worker_connections 1024;
}

http {
    server {
        listen $PORT;

        location / {
            proxy_pass https://www.youtube.com/;
            proxy_set_header Host www.youtube.com;

            # 1. User-Agentの偽装 (最新のChromeを装う)
            proxy_set_header User-Agent "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36";

            # 2. 近年のブラウザが送る Client Hints も偽装 (重要)
            proxy_set_header Sec-Ch-Ua '"Not A(Bit:Brand";v="99", "Google Chrome";v="121", "Chromium";v="121"';
            proxy_set_header Sec-Ch-Ua-Mobile "?0";
            proxy_set_header Sec-Ch-Ua-Platform '"Windows"';

            # 3. 参照元（Referer）をYouTube自身にする
            proxy_set_header Referer "https://www.youtube.com/";

            # 4. 言語設定 (botはここが空だったりするので日本語に固定)
            proxy_set_header Accept-Language "ja,en-US;q=0.9,en;q=0.8";

            # 5. IP転送の設定 (RenderのIPを隠しきれるわけではありませんが基本設定)
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            
            # YouTubeからのリダイレクト対策
            proxy_redirect off;
        }
    }
}
