events {
    worker_connections 1024;
}

http {
    server {
        # Renderは環境変数PORTで指定されたポートをリッスンする必要があります
        listen $PORT;

        location / {
            proxy_pass https://mangafire.to;

            # ターゲットサイトへのリクエストヘッダーを偽装
            proxy_set_header Host mangafire.to;
            proxy_set_header Referer https://mangafire.to/;
            proxy_set_header User-Agent "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36";
            
            # レスポンスの書き換え（自分のRenderのURLに置き換え）
            # YOUR_APP_NAME.onrender.com は自分のものに書き換えてください
            sub_filter 'mangafire.to' '$host';
            sub_filter_once off;

            # 圧縮を無効化してsub_filterを確実に適用させる
            proxy_set_header Accept-Encoding "";
            
            # セッション維持のための設定
            proxy_cookie_domain mangafire.to $host;
            proxy_ssl_server_name on;
        }
    }
}
